(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};!function(i,s,l){var h,o,n,r;r="immybox",o={choices:[],maxResults:50,showArrow:!0,openOnClick:!0,defaultSelectedValue:void 0,filterFn:function(e){return function(t){return t.text.toLowerCase().indexOf(e.toLowerCase())>=0}},formatChoice:function(e){var t;return null!=e&&""!==e?(t=new RegExp(e.replace(/[#-.]|[[-^]|[?|{}]/g,"\\$&"),"gi"),function(e){return e.text.replace(t,'<span class="highlight">$&</span>')}):function(e){return e.text}}},n=[],h=function(){function h(t,s){this.reposition=e(this.reposition,this),this.revert=e(this.revert,this),this.openResults=e(this.openResults,this),this.doSelection=e(this.doSelection,this),this.doQuery=e(this.doQuery,this);var l,h;h=this,this.element=i(t),this.element.addClass(r),this.element.attr("autocomplete","off"),this._defaults=o,this._name=r,this._element=t,this.options=i.extend({},o,s),this.choices=this.options.choices,this.selectedChoice=null,this.defaultSelectedChoice=null!=this.options.defaultSelectedValue?this.choices.filter(function(e){return e.value===h.options.defaultSelectedValue})[0]||null:this.options.defaultSelectedValue,this.options.showArrow&&this.element.addClass(r+"_witharrow"),this.options.openOnClick&&this.element.on("click",this.openResults),this.selectChoiceByValue(this.element.val()),this.queryResultArea=i("<div class='"+r+"_results'></div>"),"function"==typeof(l=this.queryResultArea).scrollLock&&l.scrollLock(),this.queryResultAreaVisible=!1,this._val=this.element.val(),this.oldQuery=this._val,this.queryResultArea.on("click","li."+r+"_choice",function(){var e;e=i(this).data("value"),h.selectChoiceByValue(e),h.hideResults(),h._val=h.element.val(),h.element.focus()}),this.queryResultArea.on("mouseenter","li."+r+"_choice",function(){h.queryResultArea.find("li."+r+"_choice.active").removeClass("active"),i(this).addClass("active")}),this.element.on("keyup change search",this.doQuery),this.element.on("keydown",this.doSelection)}return h.prototype.doQuery=function(){var e;e=this.element.val(),this._val!==e&&(this._val=e,this.oldQuery=e,""===e?(this.hideResults(),this.selectChoiceByValue(null)):this.insertFilteredChoiceElements(e))},h.prototype.doSelection=function(e){if(27===e.which&&(this.display(),this.hideResults()),this.queryResultAreaVisible)switch(e.which){case 9:this.selectHighlightedChoice();break;case 13:e.preventDefault(),this.selectHighlightedChoice();break;case 38:e.preventDefault(),this.highlightPreviousChoice(),this.scroll();break;case 40:e.preventDefault(),this.highlightNextChoice(),this.scroll()}else switch(e.which){case 40:e.preventDefault(),null!=this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("");break;case 9:this.revert()}},h.prototype.openResults=function(e){e.stopPropagation(),this.revertOtherInstances(),null!=this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("")},h.prototype.revert=function(){this.queryResultAreaVisible?(this.display(),this.hideResults()):""===this.element.val()&&this.selectChoiceByValue(null)},h.prototype.reposition=function(){this.queryResultAreaVisible&&this.positionResultsArea()},h.prototype.insertFilteredChoiceElements=function(e){var s,l,h,o,n,u,c,a;l=""===e?this.choices:this.choices.filter(this.options.filterFn(this.oldQuery)),a=l.slice(0,this.options.maxResults),(s=this.defaultSelectedChoice)&&t.call(l,s)>=0&&(t.call(a,s)<0?(a.unshift(s),a.pop()):a[0]!==s&&(a=a.filter(function(e){return e.value!==s.value}),a.unshift(s))),h=this.options.formatChoice,1===h.length&&(h=h(e)),c=!1,u=a.map(function(t){return function(s){var l;return l=i("<li class='"+r+"_choice'></li>"),l.attr("data-value",s.value),l.html(h(s,e)),s===t.selectedChoice&&(c=!0,l.addClass("active")),l}}(this)),0===u.length?(o=i("<p class='"+r+"_noresults'>no matches</p>"),this.queryResultArea.empty().append(o)):(c||null!==s&&u[0].addClass("active"),n=i("<ul></ul>").append(u),this.queryResultArea.empty().append(n)),this.showResults()},h.prototype.scroll=function(){var e,t,i,s,l,h,o;h=this.queryResultArea.height(),o=this.queryResultArea.scrollTop(),l=o+h,e=this.getHighlightedChoice(),null!=e&&(i=e.outerHeight(),s=e.position().top+o,t=s+i,o>s&&this.queryResultArea.scrollTop(s),t>l&&this.queryResultArea.scrollTop(t-h))},h.prototype.positionResultsArea=function(){var e,t,l,h,o,n;t=this.element.offset(),e=this.element.outerHeight(),l=this.element.outerWidth(),o=this.queryResultArea.outerHeight(),h=t.top+e+o,n=i(s).height()+i(s).scrollTop(),this.queryResultArea.outerWidth(l),this.queryResultArea.css({left:t.left}),h>n?this.queryResultArea.css({top:t.top-o}):this.queryResultArea.css({top:t.top+e})},h.prototype.getHighlightedChoice=function(){var e;return e=this.queryResultArea.find("li."+r+"_choice.active"),1===e.length?e:null},h.prototype.highlightNextChoice=function(){var e,t,s;t=this.getHighlightedChoice(),null!=t?(s=t.next("li."+r+"_choice"),1===s.length&&(t.removeClass("active"),s.addClass("active"))):(e=this.queryResultArea.find("li."+r+"_choice"),e.length&&i(e[0]).addClass("active"))},h.prototype.highlightPreviousChoice=function(){var e,t,s;t=this.getHighlightedChoice(),null!=t?(s=t.prev("li."+r+"_choice"),1===s.length&&(t.removeClass("active"),s.addClass("active"))):(e=this.queryResultArea.find("li."+r+"_choice"),e.length&&i(e[e.length-1]).addClass("active"))},h.prototype.selectHighlightedChoice=function(){var e,t;e=this.getHighlightedChoice(),null!=e?(t=e.data("value"),this.selectChoiceByValue(t),this._val=this.element.val(),this.hideResults()):this.revert()},h.prototype.display=function(){if(null!=this.selectedChoice?(this.selectedChoice.text,this.element.val(this.selectedChoice.text)):this.element.val(""),"undefined"!=typeof e){var e=l.createEvent("Event");e.initEvent("input",!1,!0),this._element.dispatchEvent(e)}this._val=this.element.val()},h.prototype.selectChoiceByValue=function(e){var t,i,s;i=this.getValue(),null!=e&&""!==e?(t=this.choices.filter(function(t){return t.value==e}),null!=t[0]?this.selectedChoice=t[0]:this.selectedChoice=null):this.selectedChoice=null,s=this.getValue(),s!==i&&this.element.trigger("update",[s]),this.display()},h.prototype.revertOtherInstances=function(){var e,t,i;for(e=0,t=n.length;t>e;e++)i=n[e],i!==this&&i.revert()},h.prototype.publicMethods=["showResults","hideResults","getChoices","setChoices","getValue","setValue","destroy"],h.prototype.showResults=function(){i("body").append(this.queryResultArea),this.queryResultAreaVisible=!0,this.scroll(),this.positionResultsArea()},h.prototype.hideResults=function(){this.queryResultArea.detach(),this.queryResultAreaVisible=!1},h.prototype.getChoices=function(){return this.choices},h.prototype.setChoices=function(e){return this.choices=e,null!=this.selectedChoice&&this.selectChoiceByValue(this.selectedChoice.value),this.oldQuery="",e},h.prototype.getValue=function(){return null!=this.selectedChoice?this.selectedChoice.value:null},h.prototype.setValue=function(e){var t;return t=this.getValue(),t!==e?(this.selectChoiceByValue(e),this.oldQuery="",this.getValue()):t},h.prototype.destroy=function(){this.element.off("keyup change search",this.doQuery),this.element.off("keydown",this.doSelection),this.options.openOnClick&&this.element.off("click",this.openResults),this.element.removeClass(r),this.queryResultArea.remove(),i.removeData(this.element[0],"plugin_"+r),n=n.filter(function(e){return function(t){return t!==e}}(this))},h}(),i("html").on("click",function(){var e,t,i;for(e=0,t=n.length;t>e;e++)i=n[e],i.revert()}),i(s).on("resize scroll",function(){var e,t,i;for(e=0,t=n.length;t>e;e++)i=n[e],i.queryResultAreaVisible&&i.reposition()}),i.fn[r]=function(e){var s,l;return s=Array.prototype.slice.call(arguments,1),l=[],this.each(function(){var o,u,c;if(i.data(this,"plugin_"+r)){if(null!=e&&"string"==typeof e){if(c=i.data(this,"plugin_"+r),o=e,!(t.call(c.publicMethods,o)>=0))throw new Error(r+" has no method '"+o+"'");l.push(c[o].apply(c,s))}}else u=new h(this,e),n.push(u),l.push(i.data(this,"plugin_"+r,u))}),l}}(jQuery,window,document)}).call(this);