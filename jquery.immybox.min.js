(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(c,d,e){var f,g,h,i;i="immybox",g={choices:[],maxResults:50,showArrow:!0,openOnClick:!0,defaultSelectedValue:void 0,filterFn:function(a){return function(b){return b.text.toLowerCase().indexOf(a.toLowerCase())>=0}},formatChoice:function(a){var b;return null!=a&&""!==a?(b=new RegExp(a.replace(/[#-.]|[[-^]|[?|{}]/g,"\\$&"),"gi"),function(a){return a.text.replace(b,'<span class="highlight">$&</span>')}):function(a){return a.text}}},h=[],f=function(){function e(b,d){this.reposition=a(this.reposition,this),this.revert=a(this.revert,this),this.openResults=a(this.openResults,this),this.doSelection=a(this.doSelection,this),this.doQuery=a(this.doQuery,this);var e,f;f=this,this.element=c(b),this.element.addClass(i),this.element.attr("autocomplete","off"),this._defaults=g,this._name=i,this._element=b,this.options=c.extend({},g,d),this.choices=this.options.choices,this.selectedChoice=null,this.defaultSelectedChoice=null!=this.options.defaultSelectedValue?this.choices.filter(function(a){return a.value===f.options.defaultSelectedValue})[0]||null:this.options.defaultSelectedValue,this.options.showArrow&&this.element.addClass(i+"_witharrow"),this.options.openOnClick&&this.element.on("click",this.openResults),this.selectChoiceByValue(this.element.val()),this.queryResultArea=c("<div class='"+i+"_results'></div>"),"function"==typeof(e=this.queryResultArea).scrollLock&&e.scrollLock(),this.queryResultAreaVisible=!1,this._val=this.element.val(),this.oldQuery=this._val,this.queryResultArea.on("click","li."+i+"_choice",function(){var a;a=c(this).data("value"),f.selectChoiceByValue(a),f.hideResults(),f._val=f.element.val(),f.element.focus()}),this.queryResultArea.on("mouseenter","li."+i+"_choice",function(){f.queryResultArea.find("li."+i+"_choice.active").removeClass("active"),c(this).addClass("active")}),this.element.on("keyup change search",this.doQuery),this.element.on("keydown",this.doSelection)}return e.prototype.doQuery=function(){var a;a=this.element.val(),this._val!==a&&(this._val=a,this.oldQuery=a,""===a?(this.hideResults(),this.selectChoiceByValue(null)):this.insertFilteredChoiceElements(a))},e.prototype.doSelection=function(a){if(27===a.which&&(this.display(),this.hideResults()),this.queryResultAreaVisible)switch(a.which){case 9:this.selectHighlightedChoice();break;case 13:a.preventDefault(),this.selectHighlightedChoice();break;case 38:a.preventDefault(),this.highlightPreviousChoice(),this.scroll();break;case 40:a.preventDefault(),this.highlightNextChoice(),this.scroll()}else switch(a.which){case 40:a.preventDefault(),null!=this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("");break;case 9:this.revert()}},e.prototype.openResults=function(a){a.stopPropagation(),this.revertOtherInstances(),null!=this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("")},e.prototype.revert=function(){this.queryResultAreaVisible?(this.display(),this.hideResults()):""===this.element.val()&&this.selectChoiceByValue(null)},e.prototype.reposition=function(){this.queryResultAreaVisible&&this.positionResultsArea()},e.prototype.insertFilteredChoiceElements=function(a){var d,e,f,g,h,j,k,l;e=""===a?this.choices:this.choices.filter(this.options.filterFn(this.oldQuery)),l=e.slice(0,this.options.maxResults),(d=this.defaultSelectedChoice)&&b.call(e,d)>=0&&(b.call(l,d)<0?(l.unshift(d),l.pop()):l[0]!==d&&(l=l.filter(function(a){return a.value!==d.value}),l.unshift(d))),f=this.options.formatChoice,1===f.length&&(f=f(a)),k=!1,j=l.map(function(b){return function(d){var e;return e=c("<li class='"+i+"_choice'></li>"),e.attr("data-value",d.value),e.html(f(d,a)),d===b.selectedChoice&&(k=!0,e.addClass("active")),e}}(this)),0===j.length?(g=c("<p class='"+i+"_noresults'>no matches</p>"),this.queryResultArea.empty().append(g)):(k||null!==d&&j[0].addClass("active"),h=c("<ul></ul>").append(j),this.queryResultArea.empty().append(h)),this.showResults()},e.prototype.scroll=function(){var a,b,c,d,e,f,g;f=this.queryResultArea.height(),g=this.queryResultArea.scrollTop(),e=g+f,a=this.getHighlightedChoice(),null!=a&&(c=a.outerHeight(),d=a.position().top+g,b=d+c,g>d&&this.queryResultArea.scrollTop(d),b>e&&this.queryResultArea.scrollTop(b-f))},e.prototype.positionResultsArea=function(){var a,b,e,f,g,h;b=this.element.offset(),a=this.element.outerHeight(),e=this.element.outerWidth(),g=this.queryResultArea.outerHeight(),f=b.top+a+g,h=c(d).height()+c(d).scrollTop(),this.queryResultArea.outerWidth(e),this.queryResultArea.css({left:b.left}),f>h?this.queryResultArea.css({top:b.top-g}):this.queryResultArea.css({top:b.top+a})},e.prototype.getHighlightedChoice=function(){var a;return a=this.queryResultArea.find("li."+i+"_choice.active"),1===a.length?a:null},e.prototype.highlightNextChoice=function(){var a,b,d;b=this.getHighlightedChoice(),null!=b?(d=b.next("li."+i+"_choice"),1===d.length&&(b.removeClass("active"),d.addClass("active"))):(a=this.queryResultArea.find("li."+i+"_choice"),a.length&&c(a[0]).addClass("active"))},e.prototype.highlightPreviousChoice=function(){var a,b,d;b=this.getHighlightedChoice(),null!=b?(d=b.prev("li."+i+"_choice"),1===d.length&&(b.removeClass("active"),d.addClass("active"))):(a=this.queryResultArea.find("li."+i+"_choice"),a.length&&c(a[a.length-1]).addClass("active"))},e.prototype.selectHighlightedChoice=function(){var a,b;a=this.getHighlightedChoice(),null!=a?(b=a.data("value"),this.selectChoiceByValue(b),this._val=this.element.val(),this.hideResults()):this.revert()},e.prototype.display=function(){null!=this.selectedChoice?(this.selectedChoice.text,this.element.val(this.selectedChoice.text)):this.element.val(""),"undefined"!=typeof Event&&this._element.dispatchEvent(new Event("input")),this._val=this.element.val()},e.prototype.selectChoiceByValue=function(a){var b,c,d;c=this.getValue(),null!=a&&""!==a?(b=this.choices.filter(function(b){return b.value==a}),null!=b[0]?this.selectedChoice=b[0]:this.selectedChoice=null):this.selectedChoice=null,d=this.getValue(),d!==c&&this.element.trigger("update",[d]),this.display()},e.prototype.revertOtherInstances=function(){var a,b,c;for(a=0,b=h.length;b>a;a++)c=h[a],c!==this&&c.revert()},e.prototype.publicMethods=["showResults","hideResults","getChoices","setChoices","getValue","setValue","destroy"],e.prototype.showResults=function(){c("body").append(this.queryResultArea),this.queryResultAreaVisible=!0,this.scroll(),this.positionResultsArea()},e.prototype.hideResults=function(){this.queryResultArea.detach(),this.queryResultAreaVisible=!1},e.prototype.getChoices=function(){return this.choices},e.prototype.setChoices=function(a){return this.choices=a,null!=this.selectedChoice&&this.selectChoiceByValue(this.selectedChoice.value),this.oldQuery="",a},e.prototype.getValue=function(){return null!=this.selectedChoice?this.selectedChoice.value:null},e.prototype.setValue=function(a){var b;return b=this.getValue(),b!==a?(this.selectChoiceByValue(a),this.oldQuery="",this.getValue()):b},e.prototype.destroy=function(){this.element.off("keyup change search",this.doQuery),this.element.off("keydown",this.doSelection),this.options.openOnClick&&this.element.off("click",this.openResults),this.element.removeClass(i),this.queryResultArea.remove(),c.removeData(this.element[0],"plugin_"+i),h=h.filter(function(a){return function(b){return b!==a}}(this))},e}(),c("html").on("click",function(){var a,b,c;for(a=0,b=h.length;b>a;a++)c=h[a],c.revert()}),c(d).on("resize scroll",function(){var a,b,c;for(a=0,b=h.length;b>a;a++)c=h[a],c.queryResultAreaVisible&&c.reposition()}),c.fn[i]=function(a){var d,e;return d=Array.prototype.slice.call(arguments,1),e=[],this.each(function(){var g,j,k;if(c.data(this,"plugin_"+i)){if(null!=a&&"string"==typeof a){if(k=c.data(this,"plugin_"+i),g=a,!(b.call(k.publicMethods,g)>=0))throw new Error(i+" has no method '"+g+"'");e.push(k[g].apply(k,d))}}else j=new f(this,a),h.push(j),e.push(c.data(this,"plugin_"+i,j))}),e}}(jQuery,window,document)}).call(this);